


ARM Macro Assembler    Page 1 


    1 00000000         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                       ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2 00000000         ;;
    3 00000000         ;;
    4 00000000         ;; UNIT:    inittime
    5 00000000         ;; PURPOSE: initialize the systick interrrupt
    6 00000000         ;; 
    7 00000000         ;;
    8 00000000         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                       ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    9 00000000         
   10 00000000         
   11 00000000         ;Equates
   12 00000000         
   13 00000000         ;myEquate EQU 0x12345678
   14 00000000 E000E014 
                       STK_RVR EQU              0xE000E014  ; Systick Reload Va
                                                            lue Register Addr
   15 00000000 00000064 
                       PERIOD  EQU              100         ; set up a period i
                                                            m ms
   16 00000000 000493DF 
                       LOAD_VAL
                               EQU              24000000/8*PERIOD/1000-1 ; this
                                                             value is decrement
                                                            ed each cycle, such
                                                             that
   17 00000000         ; the amount of time taken to decrement is equal to the 
                       desired period
   18 00000000 E000E010 
                       STK_CTRL
                               EQU              0xE000E010
   19 00000000         
   20 00000000         
   21 00000000         
   22 00000000                 AREA             MyConst, DATA, READONLY ; alloc
                                                            ates memory for ini
                                                            tialized data
   23 00000000         
   24 00000000         ;const_label Your DCB, , DCW, DCD, etc. statements go he
                       re.
   25 00000000         
   26 00000000                 AREA             MyData, DATA, READWRITE ; alloc
                                                            ates memory for uni
                                                            nitialized data
   27 00000000         
   28 00000000         ;data_label Your SPACE, etc. statements go here.
   29 00000000         
   30 00000000                 AREA             ARMex, CODE, READONLY
   31 00000000                 ENTRY
   32 00000000         inittime
                               PROC
   33 00000000                 EXPORT           inittime
   34 00000000         
   35 00000000         ;-------------------------------------------------------
                       -----------------------------
   36 00000000         ;your code goes here
   37 00000000 BF00            nop
   38 00000002 B500            push             {lr}



ARM Macro Assembler    Page 2 


   39 00000004 E92D 07FF       push             {r0-r10}    ;This is just a hab
                                                            it.
   40 00000008         
   41 00000008         ;Subunit 1: initialize count down value
   42 00000008 4809            ldr              R0, =LOAD_VAL
   43 0000000A 490A            ldr              R1, =STK_RVR
   44 0000000C 6008            str              R0, [R1]    ;count is in R1 now
                                                            
   45 0000000E         
   46 0000000E         ;Subunit 2: start the tick
   47 0000000E         ; last three bits => 011 <=> 0x3
   48 0000000E         ;since we have a bit pattern involving 1/0 then best
   49 0000000E         ;practice is to use and to clear the register bits we wa
                       nt
   50 0000000E         ;to set, then use orr to enable the specific bits
   51 0000000E 480A            ldr              r0, =STK_CTRL
   52 00000010 F04F 0103       ldr              r1, =0x3    ;00..11
   53 00000014 6802            ldr              r2, [r0]
   54 00000016 F06F 030F       ldr              r3, =0xFFFFFFF0
   55 0000001A EA02 0203       and              r2, r3      ;reset the last 4 b
                                                            its by clearing
   56 0000001E EA42 0201       orr              r2, r1
   57 00000022 6002            str              r2, [r0]
   58 00000024         
   59 00000024 E8BD 07FF       pop              {r0-r10}
   60 00000028 F85D EB04       pop              {lr}
   61 0000002C 4770            bx               lr
   62 0000002E         ;; Test report: initial: ST_RELOAD -> 0x000493DF, Enable
                       d clock, and tick int is set! Else zero in STK_CTRL
   63 0000002E         ;;
   64 0000002E         
   65 0000002E         
   66 0000002E                 ENDP
   67 0000002E                 END
              00 00 000493DF 
              E000E014 
              E000E010 
Command Line: --debug --xref --diag_suppress=9931 --cpu=Cortex-M3 --depend=.\in
ittime.d -o.\inittime.o -I.\RTE\_AsmTemplate -IC:\Users\etben\AppData\Local\Arm
\Packs\ARM\CMSIS\5.5.1\CMSIS\Core\Include -IC:\Users\etben\AppData\Local\Arm\Pa
cks\Keil\STM32F1xx_DFP\2.4.1\Device\Include --predefine="__EVAL SETA 1" --prede
fine="__UVISION_VERSION SETA 528" --predefine="_RTE_ SETA 1" --predefine="STM32
F10X_MD SETA 1" --list=.\inittime.lst inittime.s



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

MyConst 00000000

Symbol: MyConst
   Definitions
      At line 22 in file inittime.s
   Uses
      None
Comment: MyConst unused
1 symbol



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

MyData 00000000

Symbol: MyData
   Definitions
      At line 26 in file inittime.s
   Uses
      None
Comment: MyData unused
1 symbol



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

ARMex 00000000

Symbol: ARMex
   Definitions
      At line 30 in file inittime.s
   Uses
      None
Comment: ARMex unused
inittime 00000000

Symbol: inittime
   Definitions
      At line 32 in file inittime.s
   Uses
      At line 33 in file inittime.s
Comment: inittime used once
2 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Absolute symbols

LOAD_VAL 000493DF

Symbol: LOAD_VAL
   Definitions
      At line 16 in file inittime.s
   Uses
      At line 42 in file inittime.s
Comment: LOAD_VAL used once
PERIOD 00000064

Symbol: PERIOD
   Definitions
      At line 15 in file inittime.s
   Uses
      At line 16 in file inittime.s
Comment: PERIOD used once
STK_CTRL E000E010

Symbol: STK_CTRL
   Definitions
      At line 18 in file inittime.s
   Uses
      At line 51 in file inittime.s
Comment: STK_CTRL used once
STK_RVR E000E014

Symbol: STK_RVR
   Definitions
      At line 14 in file inittime.s
   Uses
      At line 43 in file inittime.s
Comment: STK_RVR used once
4 symbols
344 symbols in table
