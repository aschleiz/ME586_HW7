


ARM Macro Assembler    Page 1 


    1 00000000         ;Equates
    2 00000000 40010414 
                       EXTI_PR EQU              0x40010414
    3 00000000 00000002 
                       EXTI1_PReset
                               EQU              0x02
    4 00000000 0000001B 
                       esc_char
                               EQU              0x1B
    5 00000000         
    6 00000000                 AREA             MyConst, DATA, READONLY ; alloc
                                                            ates memory for ini
                                                            tialized data
    7 00000000         
    8 00000000         ;const_label Your DCB, , DCW, DCD, etc. statements go he
                       re.
    9 00000000         
   10 00000000                 AREA             MyData, DATA, READWRITE ; alloc
                                                            ates memory for uni
                                                            nitialized data
   11 00000000         
   12 00000000 00 00   clicks  SPACE            2           ; Initializes 16 bi
                                                            t (2 byte) space fo
                                                            r clicks
   13 00000002 00 00   outclicks
                               SPACE            2
   14 00000004         
   15 00000004                 AREA             ARMex, CODE, READONLY
   16 00000000                 ENTRY
   17 00000000         __main  PROC
   18 00000000                 EXPORT           __main
   19 00000000         
   20 00000000                 IMPORT           initint
   21 00000000                 IMPORT           serialIO
   22 00000000                 IMPORT           initcom
   23 00000000                 IMPORT           checkcom
   24 00000000                 IMPORT           getchar
   25 00000000                 IMPORT           shownum
   26 00000000                 IMPORT           inittime
   27 00000000         ; Test code
   28 00000000         ;mov r0, #0
   29 00000000         
   30 00000000         ;D1 -------------------------------
   31 00000000         ; Initialize clicks (halfword) to zero
   32 00000000 481F            ldr              R0, =clicks
   33 00000002 F04F 0100       mov              R1, #0x0000
   34 00000006 8001            STRH             R1, [R0]
   35 00000008         ; Initialize outclicks (halfword) to zero
   36 00000008 481E            ldr              R0, =outclicks
   37 0000000A F04F 0100       mov              R1, #0x0000
   38 0000000E 8001            strh             R1, [R0]
   39 00000010         ;-----------------------------------
   40 00000010         
   41 00000010         
   42 00000010         ;D2 --------------------------------
   43 00000010 F7FF FFFE       bl               initint     ; Set up EXT1_IRQ p
                                                            ort
   44 00000014         
   45 00000014         ;D3 --------------------------------



ARM Macro Assembler    Page 2 


   46 00000014 F7FF FFFE       bl               inittime    ; Set up timer
   47 00000018         ;mov R1, #0
   48 00000018 E015            b                done        ;test code
   49 0000001A         ;D4 --------------------------------
   50 0000001A F7FF FFFE       bl               initcom
   51 0000001E         
   52 0000001E         
   53 0000001E         ;------------------ this loops forever unless beq holds 
                       -----
   54 0000001E         ;
   55 0000001E         ; Desired behavior: output when outlicks is nonzero, the
                       n set outclicks to zero
   56 0000001E         ; Desired behavior: when outclicks zero, checkcom and de
                       cide what to do next
   57 0000001E         ; Log:
   58 0000001E         
   59 0000001E         
   60 0000001E BF00    loop    nop
   61 00000020         ;XXX D5-1 -------------------------------------------
   62 00000020 4B18            ldr              R3, =outclicks ;The following d
                                                            idn't work because 
                                                            we load an address:
                                                             ldrh R3, =outclick
                                                            s
   63 00000022 8818            ldrh             R0, [R3]
   64 00000024 2800            cmp              R0, #0
   65 00000026 D108            bne              output      ;branch away when t
                                                            wo values are not e
                                                            qual
   66 00000028         ;------------------------------------------------
   67 00000028         ;[DEBUG] Checkcom: 
   68 00000028 F7FF FFFE       bl               checkcom
   69 0000002C 2800            cmp              R0, #0x00
   70 0000002E D1FF            bne              input       ;branch away when c
                                                            heckcom has nonzero
                                                            .
   71 00000030         
   72 00000030 F7FF FFFE 
                       input   bl               getchar
   73 00000034         
   74 00000034 281B            cmp              R0, #esc_char
   75 00000036 D006            beq              done
   76 00000038 E7F1            b                loop
   77 0000003A         ;XXX D5-2 ----------------------------------------------
                       ------------   
   78 0000003A F7FF FFFE 
                       output  bl               shownum
   79 0000003E         
   80 0000003E         ;ldrh R0,=0x0 ; not allowed because = only works for ldr
                       
   81 0000003E F04F 0000       ldr              R0,=0x0     ;zero out outclicks
                                                            
   82 00000042 8018            strh             R0, [R3]
   83 00000044 E7EB            b                loop
   84 00000046         ;-------------------------------------------------------
                       --------
   85 00000046 E7FE    done    b                done
   86 00000048         
   87 00000048                 ENDP



ARM Macro Assembler    Page 3 


   88 00000048         ;;
   89 00000048         ;; Desired behavior: increment the clicks whenever the w
                       aveform is changing sine
   90 00000048         ;;
   91 00000048         EXTI1_IRQHandler
                               PROC
   92 00000048                 EXPORT           EXTI1_IRQHandler
   93 00000048 B500            push             {LR}
   94 0000004A         
   95 0000004A 480D            ldr              R0, =clicks
   96 0000004C 6801            ldr              R1, [R0]
   97 0000004E F101 0101       add              R1, #1
   98 00000052 6001            str              R1, [R0]
   99 00000054         
  100 00000054 480C            ldr              R0, =EXTI_PR
  101 00000056 F04F 0102       mov              R1, #EXTI1_PReset
  102 0000005A 6001            str              R1, [R0]
  103 0000005C         ; Instructions
  104 0000005C F85D EB04       pop              {LR}
  105 00000060 4770            bx               lr
  106 00000062                 ENDP
  107 00000062         
  108 00000062         ;; I: clicks and outlicks
  109 00000062         ;; O: *outclicks = *clicks, *clicks => 0
  110 00000062         ;; 
  111 00000062         SysTick_Handler
                               PROC                         ;Future question to
                                                             address: search mi
                                                            crovision docs to f
                                                            ind where the whole
                                                             table is located
  112 00000062                 EXPORT           SysTick_Handler
  113 00000062 B500            push             {lr}
  114 00000064 E92D 07FF       push             {r0-r10}
  115 00000068         ;r3 is the setter variable, others are used for storing 
                       addresses
  116 00000068 4805            ldr              r0, =clicks
  117 0000006A 4906            ldr              r1, =outclicks
  118 0000006C 8803            ldrh             r3, [r0]    ; 2 byte load is ne
                                                            eded, now r3 has th
                                                            e value of clicks  
                                                                           
  119 0000006E 800B            strh             r3, [r1]    ; copy clicks to ou
                                                            tlicks, but make su
                                                            re to send only 16 
                                                            bits since it is 
  120 00000070 F04F 0300       ldr              r3, =0x0    ; clear the setter 
                                                            variable
  121 00000074 6003            str              r3, [r0]    ; reset clicks to z
                                                            ero
  122 00000076         
  123 00000076         
  124 00000076         
  125 00000076 E8BD 07FF       pop              {r0-r10}
  126 0000007A F85D EB04       pop              {lr}
  127 0000007E 4770            bx               lr
  128 00000080                 ENDP
  129 00000080                 END
              00000000 



ARM Macro Assembler    Page 4 


              00000000 
              40010414 
Command Line: --debug --xref --diag_suppress=9931 --cpu=Cortex-M3 --depend=.\la
b4main.d -o.\lab4main.o -I.\RTE\_AsmTemplate -IC:\Users\etben\AppData\Local\Arm
\Packs\ARM\CMSIS\5.5.1\CMSIS\Core\Include -IC:\Users\etben\AppData\Local\Arm\Pa
cks\Keil\STM32F1xx_DFP\2.4.1\Device\Include --predefine="__EVAL SETA 1" --prede
fine="__UVISION_VERSION SETA 528" --predefine="_RTE_ SETA 1" --predefine="STM32
F10X_MD SETA 1" --list=.\lab4main.lst lab4main.s



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

MyConst 00000000

Symbol: MyConst
   Definitions
      At line 6 in file lab4main.s
   Uses
      None
Comment: MyConst unused
1 symbol



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

MyData 00000000

Symbol: MyData
   Definitions
      At line 10 in file lab4main.s
   Uses
      None
Comment: MyData unused
clicks 00000000

Symbol: clicks
   Definitions
      At line 12 in file lab4main.s
   Uses
      At line 32 in file lab4main.s
      At line 95 in file lab4main.s
      At line 116 in file lab4main.s

outclicks 00000002

Symbol: outclicks
   Definitions
      At line 13 in file lab4main.s
   Uses
      At line 36 in file lab4main.s
      At line 62 in file lab4main.s
      At line 117 in file lab4main.s

3 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

ARMex 00000000

Symbol: ARMex
   Definitions
      At line 15 in file lab4main.s
   Uses
      None
Comment: ARMex unused
EXTI1_IRQHandler 00000048

Symbol: EXTI1_IRQHandler
   Definitions
      At line 91 in file lab4main.s
   Uses
      At line 92 in file lab4main.s
Comment: EXTI1_IRQHandler used once
SysTick_Handler 00000062

Symbol: SysTick_Handler
   Definitions
      At line 111 in file lab4main.s
   Uses
      At line 112 in file lab4main.s
Comment: SysTick_Handler used once
__main 00000000

Symbol: __main
   Definitions
      At line 17 in file lab4main.s
   Uses
      At line 18 in file lab4main.s
Comment: __main used once
done 00000046

Symbol: done
   Definitions
      At line 85 in file lab4main.s
   Uses
      At line 48 in file lab4main.s
      At line 75 in file lab4main.s
      At line 85 in file lab4main.s

input 00000030

Symbol: input
   Definitions
      At line 72 in file lab4main.s
   Uses
      At line 70 in file lab4main.s
Comment: input used once
loop 0000001E

Symbol: loop
   Definitions
      At line 60 in file lab4main.s
   Uses
      At line 76 in file lab4main.s
      At line 83 in file lab4main.s




ARM Macro Assembler    Page 2 Alphabetic symbol ordering
Relocatable symbols

output 0000003A

Symbol: output
   Definitions
      At line 78 in file lab4main.s
   Uses
      At line 65 in file lab4main.s
Comment: output used once
8 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Absolute symbols

EXTI1_PReset 00000002

Symbol: EXTI1_PReset
   Definitions
      At line 3 in file lab4main.s
   Uses
      At line 101 in file lab4main.s
Comment: EXTI1_PReset used once
EXTI_PR 40010414

Symbol: EXTI_PR
   Definitions
      At line 2 in file lab4main.s
   Uses
      At line 100 in file lab4main.s
Comment: EXTI_PR used once
esc_char 0000001B

Symbol: esc_char
   Definitions
      At line 4 in file lab4main.s
   Uses
      At line 74 in file lab4main.s
Comment: esc_char used once
3 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
External symbols

checkcom 00000000

Symbol: checkcom
   Definitions
      At line 23 in file lab4main.s
   Uses
      At line 68 in file lab4main.s
Comment: checkcom used once
getchar 00000000

Symbol: getchar
   Definitions
      At line 24 in file lab4main.s
   Uses
      At line 72 in file lab4main.s
Comment: getchar used once
initcom 00000000

Symbol: initcom
   Definitions
      At line 22 in file lab4main.s
   Uses
      At line 50 in file lab4main.s
Comment: initcom used once
initint 00000000

Symbol: initint
   Definitions
      At line 20 in file lab4main.s
   Uses
      At line 43 in file lab4main.s
Comment: initint used once
inittime 00000000

Symbol: inittime
   Definitions
      At line 26 in file lab4main.s
   Uses
      At line 46 in file lab4main.s
Comment: inittime used once
serialIO 00000000

Symbol: serialIO
   Definitions
      At line 21 in file lab4main.s
   Uses
      None
Comment: serialIO unused
shownum 00000000

Symbol: shownum
   Definitions
      At line 25 in file lab4main.s
   Uses
      At line 78 in file lab4main.s
Comment: shownum used once
7 symbols
358 symbols in table
